<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial 1: predict the agent  â€¢ DRDNetPro</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Tutorial 1: predict the agent ">
<meta property="og:description" content="DRDNetPro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">DRDNetPro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/NAME-OF-VIGNETTE.html">Tutorial summary</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../../articles/web/Tutorial%201.html">Tutorial 1</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../../articles/web/Tutorial%202.html">Tutorial 2</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../../articles/web/Tutorial%203.html">Tutorial 3</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chencxxy28/DRDNetPro/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial 1: predict the agent</h1>
                        <h4 data-toc-skip class="author">Chixiang
Chen</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chencxxy28/DRDNetPro/blob/HEAD/vignettes/web/Tutorial%201.Rmd" class="external-link"><code>vignettes/web/Tutorial 1.Rmd</code></a></small>
      <div class="hidden name"><code>Tutorial 1.Rmd</code></div>

    </div>

    
    
<p><strong>DRDNetPro</strong> is a statistical learning algorithm for
recover disease risk-associated pseudo-dynamic networks (DRDNet) from
steady-state data. It incorporates risk prediction model, a varying
coefficient model, multiple ordinary differential equations, and group
lasso estimation to learn a series of networks.This tutorial will
provide detailed information for the first step of implementing the <a href="https://academic.oup.com/bioinformatics/article-abstract/38/9/2481/6537533" class="external-link">DRDNet</a>.</p>
<p>To begin with, we need to install the following packages in R</p>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"devtools"</span>)) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"chencxxy28/DRDNetPro"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>add more here??</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://expasy.org/tools/pROC/" class="external-link">pROC</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Type 'citation("pROC")' for a citation.</span></code></pre>
<pre><code><span class="co">## </span>
<span class="co">## Attaching package: 'pROC'</span></code></pre>
<pre><code><span class="co">## The following objects are masked from 'package:stats':</span>
<span class="co">## </span>
<span class="co">##     cov, smooth, var</span></code></pre>
</div>
<div class="section level1">
<h1 id="prepare-the-data-for-training-the-agent">Prepare the data for training the agent<a class="anchor" aria-label="anchor" href="#prepare-the-data-for-training-the-agent"></a>
</h1>
<p>Before predicting the agent, the users need to prepare the data for
training the model. The data is required to be a matrix, which includes
the outcome in the first column and all potential predictors in the
remaining columns. Do not include the intercept as one column. The
outcome in this protocol is in the binary scale (e.g., 0=no disease and
1=disease), which in practice indicates the disease status. All values
in the matrix should be numeric. The missing data is allowed in this
training process, though it is always recommended to have a complete
data as an input. The following working data is from one sample of data
in GTEx project and deidentified.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#read the data</span>
<span class="va">pheno_raw</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"pheno_used.csv"</span><span class="op">)</span>
<span class="co">#rearrange the data</span>
<span class="va">pheno_used</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>MHHTN<span class="op">=</span><span class="va">pheno_raw</span><span class="op">$</span><span class="va">MHHTN</span>,<span class="va">pheno_raw</span><span class="op">[</span>,<span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pheno_raw</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MHHTN"</span>,<span class="st">"SUBJID"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pheno_used</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   MHHTN SEX AGE HGHT   BMI MHASTHMA MHCOPD MHDRNKSTS MHHRTATT MHHRTDIS MHSMKSTS</span>
<span class="co">## 1     1   1  66   66 32.12        0      0         1        0        1        1</span>
<span class="co">## 2     0   0  57   70 33.57        0      0         1        0        0        1</span>
<span class="co">## 3     0   0  61   73 25.06        0      0         1        0        0        0</span>
<span class="co">## 4     0   0  63   69 29.53        0      0         0        1        0        0</span>
<span class="co">## 5     1   0  62   72 30.78        0      0         1        0        1        1</span>
<span class="co">## 6     1   1  64   66 32.76        0      0         1        0        0        1</span>
<span class="co">##   MHT1D MHT2D</span>
<span class="co">## 1     0     0</span>
<span class="co">## 2     0     0</span>
<span class="co">## 3     0     0</span>
<span class="co">## 4     0     1</span>
<span class="co">## 5     0     1</span>
<span class="co">## 6     0     0</span></code></pre>
</div>
<div class="section level1">
<h1 id="build-up-the-training-model">Build up the training model<a class="anchor" aria-label="anchor" href="#build-up-the-training-model"></a>
</h1>
<p>There is no unique way to predict the agent. Statistical regression
models or machine learning algorithms can be applied. In our program, we
allow the users to specify their own method, which includes conventional
logistic regression, random forest, and XGBoost.</p>
<div class="section level2">
<h2 id="logistic-regression">logistic regression<a class="anchor" aria-label="anchor" href="#logistic-regression"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">MHHTN</span><span class="op">~</span><span class="va">AGE</span><span class="op">+</span><span class="va">HGHT</span><span class="op">+</span><span class="va">BMI</span><span class="op">+</span><span class="va">MHASTHMA</span><span class="op">+</span><span class="va">MHCOPD</span><span class="op">+</span><span class="va">MHHRTATT</span><span class="op">+</span><span class="va">MHHRTDIS</span><span class="op">+</span><span class="va">MHT1D</span><span class="op">+</span><span class="va">MHT2D</span><span class="op">+</span><span class="va">MHDRNKSTS</span><span class="op">+</span><span class="va">SEX</span>,data<span class="op">=</span><span class="va">pheno_used</span>,family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>
<span class="va">rate</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##  0.0563  0.3559  0.5572  0.5587  0.7971  0.9891</span></code></pre>
</div>
<div class="section level2">
<h2 id="random-forest">Random forest<a class="anchor" aria-label="anchor" href="#random-forest"></a>
</h2>
<p>add later??</p>
</div>
<div class="section level2">
<h2 id="xgboost">XGBoost<a class="anchor" aria-label="anchor" href="#xgboost"></a>
</h2>
<p>add later??</p>
</div>
</div>
<div class="section level1">
<h1 id="predict-and-evaluate-the-agent">Predict and evaluate the agent<a class="anchor" aria-label="anchor" href="#predict-and-evaluate-the-agent"></a>
</h1>
<p>When the agent and trained, it is better to check its prediction
performance. Note that the pseudo-dynamic network is sensitive to the
values of agent, and the agent with good prediction to the disease risk
is more preferred. To check its performance, we can use ROC and AUC
value. For evaluation purpose, we need to create a training data and
testing data. The training data is used for data fitting, whereas the
testing data is used for prediction evaluation. Below, we consider 90%
of data for training and 10% of data for testing.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span>
<span class="va">sample.ind</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pheno_used</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pheno_used</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#id used for training</span>
<span class="va">pheno_used_training</span><span class="op">&lt;-</span><span class="va">pheno_used</span><span class="op">[</span><span class="va">sample.ind</span>,<span class="op">]</span>
<span class="va">pheno_used_testing</span><span class="op">&lt;-</span><span class="va">pheno_used</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pheno_used</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample.ind</span><span class="op">)</span>,<span class="op">]</span>

<span class="va">fit_train</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">MHHTN</span><span class="op">~</span><span class="va">AGE</span><span class="op">+</span><span class="va">HGHT</span><span class="op">+</span><span class="va">BMI</span><span class="op">+</span><span class="va">MHASTHMA</span><span class="op">+</span><span class="va">MHCOPD</span><span class="op">+</span><span class="va">MHHRTATT</span><span class="op">+</span><span class="va">MHHRTDIS</span><span class="op">+</span><span class="va">MHT1D</span><span class="op">+</span><span class="va">MHT2D</span><span class="op">+</span><span class="va">MHDRNKSTS</span><span class="op">+</span><span class="va">SEX</span>,data<span class="op">=</span><span class="va">pheno_used_training</span>,family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>

<span class="va">test_prob</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_train</span>, newdata <span class="op">=</span> <span class="va">pheno_used_testing</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">test_roc_specific</span> <span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">pheno_used_testing</span><span class="op">$</span><span class="va">MHHTN</span> <span class="op">~</span> <span class="va">test_prob</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, print.auc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial%201_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The AUC value is around 0.83, which is desired. Similar procedure
could be applied to the case with random forest or XGBoost. After the
agent imputation, we can move forward to the stage of network learning,
which is illustrated in ?? Before the end of this tutorial, let us
create the data used for the next tutorial</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pheno_subject_id</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">pheno_raw</span><span class="op">$</span><span class="va">SUBJID</span>,<span class="fl">6</span>,<span class="fl">10</span><span class="op">)</span>
<span class="va">pheno_together</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pheno_subject_id</span>,<span class="va">rate</span>,<span class="va">pheno_used</span><span class="op">$</span><span class="va">MHSMKSTS</span>,<span class="va">pheno_used</span><span class="op">$</span><span class="va">SEX</span>,<span class="va">pheno_used</span><span class="op">$</span><span class="va">HGHT</span>,<span class="va">pheno_used</span><span class="op">$</span><span class="va">BMI</span>,<span class="va">pheno_used</span><span class="op">$</span><span class="va">MHHTN</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pheno_together</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>,<span class="st">"rate"</span>,<span class="st">"smoke"</span>,<span class="st">"sex"</span>,<span class="st">"height"</span>,<span class="st">"bmi"</span>,<span class="st">"hyper"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pheno_together</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      id              rate smoke sex height   bmi hyper</span>
<span class="co">## 1 1117F 0.858620894429252     1   1     66 32.12     1</span>
<span class="co">## 2 111CU  0.59473507595632     1   0     70 33.57     0</span>
<span class="co">## 3 111FC 0.528193073054949     0   0     73 25.06     0</span>
<span class="co">## 4 111VG 0.890841096353928     0   0     69 29.53     0</span>
<span class="co">## 5 111YS 0.946066339003859     1   0     72 30.78     1</span>
<span class="co">## 6 1122O 0.694087589148978     1   1     66 32.76     1</span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">pheno_together</span>,<span class="st">"pheno_together.csv"</span>,row.names <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Chixiang Chen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
